import PySimpleGUI as sg
import random
from huvudstadsfragor import europeiska_huvudstader

def create_window():
    sg.theme('Reddit')  # Sätt ett tema för att förbättra utseendet

    layout = [
        [sg.Text('Välj huvudstaden för följande land:', font=('Helvetica', 16), justification='center')],
        [sg.Text('', font=('Helvetica', 16), key='-QUESTION-', justification='center')],
        [sg.Listbox([], size=(20, 4), key='CHOICE', font=('Helvetica', 14), enable_events=True)],
        [sg.Button('Svara', font=('Helvetica', 14), bind_return_key=True), sg.Button('Nästa', font=('Helvetica', 14))]
    ]

    return sg.Window('Europeiska Huvudstäder Quiz', layout, finalize=True, element_justification='c')

def update_question(window, europeiska_huvudstader, question_number):
    question, correct_answer = europeiska_huvudstader[question_number]
    wrong_answers = random.sample([answer for q, answer in europeiska_huvudstader if answer != correct_answer], 3)
    choices = wrong_answers + [correct_answer]
    random.shuffle(choices)
    window['CHOICE'].update(choices)
    window['-QUESTION-'].update(question)
    return correct_answer

def main():
    random.shuffle(europeiska_huvudstader)
    score = 0
    question_number = 0
    window = create_window()
    correct_answer = update_question(window, europeiska_huvudstader, question_number)

    while True:
        event, values = window.read()

        if event in (sg.WIN_CLOSED, 'Avsluta'):
            break

        if event == 'Svara' and values['CHOICE']:
            user_choice = values['CHOICE'][0]
            if user_choice == correct_answer:
                sg.popup('Rätt!', 'Du har fått en poäng.', font=('Helvetica', 14))
                score += 1
            else:
                sg.popup('Fel!', f'Rätt svar var {correct_answer}.', font=('Helvetica', 14))

        if event == 'Nästa':
            question_number += 1
            if question_number < len(europeiska_huvudstader):
                correct_answer = update_question(window, europeiska_huvudstader, question_number)
            else:
                sg.popup(f'Ditt slutresultat är {score} poäng', font=('Helvetica', 14))
                break
    
    window.close()

if __name__ == "__main__":
    main()
